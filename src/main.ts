import * as core from '@actions/core'
import { exec } from "@actions/exec";

async function run(): Promise<void> {
  try {
    const srcdir: string = core.getInput('srcdir')
    const name: string = core.getInput('name')
    core.debug(`srcdir = ${srcdir} `)
    core.debug(`name = ${name} `)

    core.debug(new Date().toTimeString())
    await exec(`brew install create-dmg`);
    core.debug(new Date().toTimeString())

    const b1 = Buffer.from("\
89504E470D0A1A0A0000000D49484452\
000003200000014608060000009242FB\
06000000097048597300000B1300000B\
1301009A9C180000065669545874584D\
4C3A636F6D2E61646F62652E786D7000\
000000003C3F787061636B6574206265\
67696E3D22EFBBBF222069643D225735\
4D304D7043656869487A7265537A4E54\
637A6B633964223F3E203C783A786D70\
6D65746120786D6C6E733A783D226164\
6F62653A6E733A6D6574612F2220783A\
786D70746B3D2241646F626520584D50\
20436F726520372E322D633030302037\
392E3536366562633562342C20323032\
322F30352F30392D30383A32353A3535\
2020202020202020223E203C7264663A\
52444620786D6C6E733A7264663D2268\
7474703A2F2F7777772E77332E6F7267\
2F313939392F30322F32322D7264662D\
73796E7461782D6E7323223E203C7264\
663A4465736372697074696F6E207264\
663A61626F75743D222220786D6C6E73\
3A786D703D22687474703A2F2F6E732E\
61646F62652E636F6D2F7861702F312E\
302F2220786D6C6E733A64633D226874\
74703A2F2F7075726C2E6F72672F6463\
2F656C656D656E74732F312E312F2220\
786D6C6E733A70686F746F73686F703D\
22687474703A2F2F6E732E61646F6265\
2E636F6D2F70686F746F73686F702F31\
2E302F2220786D6C6E733A786D704D4D\
3D22687474703A2F2F6E732E61646F62\
652E636F6D2F7861702F312E302F6D6D\
2F2220786D6C6E733A73744576743D22\
687474703A2F2F6E732E61646F62652E\
636F6D2F7861702F312E302F73547970\
652F5265736F757263654576656E7423\
2220786D6C6E733A746966663D226874\
74703A2F2F6E732E61646F62652E636F\
6D2F746966662F312E302F2220786D6C\
6E733A657869663D22687474703A2F2F\
6E732E61646F62652E636F6D2F657869\
662F312E302F2220786D703A43726561\
7465446174653D22323032322D30382D\
32355431393A32343A32332B30383A30\
302220786D703A4D6F64696679446174\
653D22323032322D30392D3138543138\
3A31343A31362B30383A30302220786D\
703A4D65746164617461446174653D22\
323032322D30392D31385431383A3134\
3A31362B30383A3030222064633A666F\
726D61743D22696D6167652F706E6722\
2070686F746F73686F703A436F6C6F72\
4D6F64653D22332220786D704D4D3A49\
6E7374616E636549443D22786D702E69\
69643A35653632636136652D37633562\
2D343733332D623866332D3031353565\
616631353166332220786D704D4D3A44\
6F63756D656E7449443D22786D702E64\
69643A32326432396638322D61626661\
2D343735382D386334652D3562383238\
383366636534652220786D704D4D3A4F\
726967696E616C446F63756D656E7449\
443D22786D702E6469643A3232643239\
6638322D616266612D343735382D3863\
34652D35623832383833666365346522\
20746966663A4F7269656E746174696F\
6E3D22312220657869663A436F6C6F72\
53706163653D22312220657869663A50\
6978656C5844696D656E73696F6E3D22\
313238302220657869663A506978656C\
5944696D656E73696F6E3D2237323022\
3E203C786D704D4D3A486973746F7279\
3E203C7264663A5365713E203C726466\
3A6C692073744576743A616374696F6E\
3D227361766564222073744576743A69\
6E7374616E636549443D22786D702E69\
69643A32326432396638322D61626661\
2D343735382D386334652D3562383238\
38336663653465222073744576743A77\
68656E3D22323032322D30392D313854\
31373A35373A31382B30383A30302220\
73744576743A736F6674776172654167\
656E743D2241646F62652050686F746F\
73686F702032332E3420284D6163696E\
746F736829222073744576743A636861\
6E6765643D222F222F3E203C7264663A\
6C692073744576743A616374696F6E3D\
227361766564222073744576743A696E\
7374616E636549443D22786D702E6969\
643A35653632636136652D376335622D\
343733332D623866332D303135356561\
663135316633222073744576743A7768\
656E3D22323032322D30392D31385431\
383A31343A31362B30383A3030222073\
744576743A736F667477617265416765\
6E743D2241646F62652050686F746F73\
686F702032332E3420284D6163696E74\
6F736829222073744576743A6368616E\
6765643D222F222F3E203C2F7264663A\
5365713E203C2F786D704D4D3A486973\
746F72793E203C2F7264663A44657363\
72697074696F6E3E203C2F7264663A52\
44463E203C2F783A786D706D6574613E\
203C3F787061636B657420656E643D22\
72223F3ED71BB5CF00000D8E49444154\
789CEDDD3F885D677EC6F1475E59899D\
DD44851B354EA3CA6C402E0252E7D25D\
50B9ADD51961CBAF8337628DB6599002\
C3DB04635830A859DB6A4C0A21979E6A\
F10A93608448D85525070C42C5146316\
0BA1497163FC27ABEB99D1CCEF3DE7DE\
CFA71136E2CE53185D7D7DCE7BCE919D\
9D9D00000054786AF4000000607D0810\
0000A08C00010000CA08100000A08C00\
010000CA08100000A08C00010000CA08\
100000A08C00010000CA08100000A08C\
00010000CA08100000A08C00010000CA\
08100000A08C00010000CA08100000A0\
8C00010000CA08100000A08C00010000\
CA08100000A08C00010000CA08100000\
A08C00010000CA08100000A08C000100\
00CA08100000A08C00010000CA081000\
00A08C00010000CA08100000A08C0001\
0000CA08100000A08C00010000CA0810\
0000A08C00010000CA08100000A08C00\
010000CA08100000A08C00010000CA08\
100000A08C00010000CA08100000A08C\
00010000CA08100000A08C00010000CA\
08100000A08C00010000CA08100000A0\
8C00010000CA08100000A08C00010000\
CA08100000A08C00010000CA08100000\
A08C00010000CA08100000A08C000100\
00CA08100000A08C00010000CA081000\
00A08C00010000CA08100000A08C0001\
0000CA08100000A08C00010000CA0810\
0000A08C00010000CA08100000A08C00\
010000CA08100000A08C00010000CA08\
100000A08C00010000CA08100000A08C\
00010000CA08100000A08C00010000CA\
08100000A08C00010000CA08100000A0\
8C00010000CA08100000A08C00010000\
CA08100000A08C00010000CA08100000\
A08C00010000CA08100000A08C000100\
00CA08100000A08C00010000CA081000\
00A08C00010000CA08100000A08C0001\
0000CA08100000A08C00010000CA0810\
0000A08C00010000CA08100000A08C00\
010000CA08100000A08C00010000CA08\
100000A08C00010000CA08100000A08C\
00010000CA08100000A08C00010000CA\
08100000A08C00010000CA08100000A0\
8C00010000CA08100000A08C00010000\
CA08100000A08C00010000CA08100000\
A08C00010000CA08100000A08C000100\
00CA08100000A08C00010000CA081000\
00A08C000160A9D6DAC7ADB51746EF00\
60351CD9D9D919BD0180896AAD3D9BE4\
AB240F93FC36C9AF7BEFF7C7AE0260CE\
5C01016099A7FFEFD7A3495E4DF2A7D6\
DA9BADB5630337013063020480657EF2\
837F3E9E6423C9EDD6DA3FD5CF0160EE\
040800CBFCF431FFFE64927F773E0480\
BD1220003C8997937CDE5A7BA7B5F6DC\
E831004C9F00016099BFD9C5EF713E04\
805D1320002C73740FBFF778BE3D1F72\
F670E600307702048065F61220DF3899\
E4A3D6DA27ADB5170F7A1000F3264000\
586637B7603DCE4B493E6BADBDD75A3B\
71407B0098390102C0617A2AC92B49FE\
D85AFB556BED99D18300184B8000B0CC\
E31EC3BB9FCFF94D92FF6EADFDA2B576\
E4803E1780991120002CF3C317113EA9\
E793BC9FE4F7ADB57F3CE0CF06600604\
0800CB3C7D489F7B3AC9A7CE8700AC1F\
0102C032CF1EE2673B1F02B086040800\
A3391F02B046040800CBFCACF0677DF7\
7CC8E9C29F0B40210102C03223BE274E\
671121EFB7D69E1FF0F3013844020480\
658E0DFAB94792FC228BDBB27ED35A3B\
A8C70103309800016099D107C39F49F2\
AB2C0EAABFD25AF3BD053073FE200760\
0E4E24792FC967ADB597066F01E00908\
100096F9DBD1037EE0C5249FB4D63E6A\
ADFDFDE83100EC9D00016099A93E12F7\
6C92FF723E04607E040800CBFCD5E801\
4B381F023043FEB0066099BF1E3D6017\
9C0F0198110102C0AAF8EEF99093A3C7\
00F09709100096F9BBD103F6E16C92DB\
ADB58DD6DAF1D16300F83E0102C02A3A\
96E4CD247F6AADBDDA5A3B3A7A10000B\
02048065E670066499E792BC93E4F3D6\
DACBA3C700204000586ECA4FC1DA8B17\
927CDC5AFBB8B5F6C2E83100EB4C8000\
B0CC54DF03B25F2F677135E4DF9C0F01\
18438000B0CCD4DE847E108E26391FE7\
430086102000AC2BE74300061020002C\
F3CCE801059C0F012824400058E6D8E8\
0185BE391FF24E6BEDB9D16300569500\
01609975FB9E389AE4D52CCE87BCD95A\
5BA7000328B16E5F2C00ECCDCF460F18\
E478928D2CDEA87E76F0168095224000\
E0F14E26F9A8B5F6496BEDC5D1630056\
810001609967470F988897927CD65A7B\
AFB57662F41880391320002CF3F4E801\
13F254925792FCB1B5F696F32100FB23\
400058E627A3074CD04F93FC6B9C0F01\
D897233B3B3BA337003051AD355F123F\
6E3349EBBDFFE7E8210073204080C9F2\
975F66E45192AB49DEEEBD7F39780BC0\
A4091060B2040833B49DE44A92DE7BFF\
F3E8310053244080C91220CCD8DD24FF\
92E4C3DEBBFF8E01BEC32174003878CF\
27793FC9EF5B6BA7478F019812010200\
87E7741611F27E6BEDF9D16300A6C02D\
58C064B9058B15F3E7243DC995DEFBF6\
E83100A3081060B204082BEACB24FF9C\
E403E7438075E4162C00A87522C9EFE2\
7C08B0A60408008CE17C08B096DC8205\
4C965BB05823CE87006B438000932540\
58435F26793BC9D5DEFBA3D163000E83\
5BB000603A4E24792FC967ADB597066F\
013814020400A6E7C5249FB4D63E6AAD\
9D1C3D06E02009100098AEB3496EB7D6\
365A6BC7478F013808CE800093E50C08\
7CCFFD24BF4EF2DBDEFBC3D16300F6CB\
1510009887E792BC93E43F9C0F01E64C\
8000C0BCFC439C0F01664C8000C03C39\
1F02CC923320C064390302BBE67C0830\
1BAE8000C0FC7D733EE4F3D6DACBA3C7\
002C23400060751C4B7274F408806504\
0800CCDF5749DE4EF2F3DEFBF5D16300\
96F17F490060DEAE2579ABF77E77F410\
80DD102000304FB7939CEFBD6F8E1E02\
B0176EC1028079D94A7221C929F101CC\
912B2000300F8F925C4D72B1F77E6FF0\
16807D132000307D3793BCDE7BFF74F4\
108027E5162C0098AEFB49CE2539233E\
8055E10A08004CCFC324EF26B9D47BDF\
1ABC05E0400910009896CD24AFF5DE6F\
8D1E0270180408004CC3FF64F13E8F0F\
460F01384C020400C67A906423C9E5DE\
FBF6E83100874D8000C03837B278BAD5\
9DD14300AA081000A87727C91BBDF7EB\
A3870054F3185E00A8F35592B793FC5C\
7C00EBCA151000A8712D8B43E677470F\
0118E9C8CECECEE80D004C546BCD97C4\
93BB9DE47CEF7D73F4108029700B1600\
1C8EAD2417929C121F00DF720B16001C\
AC4749AE26B9D87BBF37780BC0E40810\
00383837B378ACEEA7A387004C955BB0\
00E0C9DD4F722EC919F101B09C2B2000\
B07F0F93BC9BE452EF7D6BF016805910\
2000B03F9B495EEBBDDF1A3D04604E04\
0800ECCD17497ED97BFF60F410803912\
2000B03B0F926C24B9DC7BDF1E3D0660\
AE040800FCB81B593CDDEACEE8210073\
274000E0F1EE2479A3F77E7DF4108055\
214000E0FFDB4E7225C946EFFDEBD163\
005689000180EFBB96E4ADDEFBDDD143\
00569100018085DB49CEF7DE37470F01\
5865DE840EC0BADB4A7221C929F10170\
F85C0101605D3D4A7235C9C5DEFBBDC1\
5B00D6860001601DDDCCE2B1BA9F8E1E\
02B06EDC8205C03AB99FE45C9233E203\
600C57400058070F93BC9BE452EF7D6B\
F01680B526400058759B495EEBBDDF1A\
3D04000102C0EAFA22C92F7BEF1F8C1E\
02C0B7040800ABE641928D24977BEFDB\
A3C700F07D0204805572238BA75BDD19\
3D0480BF4C8000B00AEE2479A3F77E7D\
F4100096132000CCD976922B49367AEF\
5F8F1E03C08F132000CCD5B5246FF5DE\
EF8E1E02C0EE091000E6E67692F3BDF7\
CDD14300D83B6F4207602EB6925C4872\
4A7C00CC972B20004CDDA32457935CEC\
BDDF1BBC05802724400098B29B59BCC5\
FC0FA387007030DC8205C014DD4F722E\
C919F101B05A5C0101604A1E267937C9\
A5DEFBD6E02D001C020102C0546C6671\
BBD5ADD14300383C020480D1BEC8E27D\
1E1F8E1E02C0E11320008CF220C94692\
CBBDF7EDD16300A821400018E14692D7\
7BEF77460F01A0960001A0D29D246FF4\
DEAF8F1E02C0180204800ADB49AE24D9\
E8BD7F3D7A0C00E30810000EDBB52C0E\
99DF1D3D0480F104080087E57692F3BD\
F7CDD14300980E6F4207E0A06D25B990\
E494F800E0875C0101E0A03C4A7235C9\
C5DEFBBDC15B0098280102C041B899C5\
5BCCFF307A0800D3E6162C009EC4FD24\
E7929C111F00EC862B2000ECC7C324EF\
26B9D47BDF1ABC058019112000ECD566\
16B75BDD1A3D0480F9112000ECD61759\
BCCFE3C3D14300982F0102C08F799064\
23C9E5DEFBF6E83100CC9B000160991B\
495EEFBDDF193D0480D57064676767F4\
060000604D780C2F0000504680000000\
65040800005046800000006504080000\
50468000000065040800005046800000\
00650408000050468000000065040800\
00504680000000650408000050468000\
00006504080000504680000000650408\
00005046800000006504080000504680\
00000065040800005046800000006504\
08000050468000000065040800005046\
80000000650408000050468000000065\
04080000504680000000650408000050\
46800000006504080000504680000000\
65040800005046800000006504080000\
50468000000065040800005046800000\
00650408000050468000000065040800\
00504680000000650408000050468000\
00006504080000504680000000650408\
00005046800000006504080000504680\
00000065040800005046800000006504\
08000050468000000065040800005046\
80000000650408000050468000000065\
04080000504680000000650408000050\
46800000006504080000504680000000\
65040800005046800000006504080000\
50468000000065040800005046800000\
00650408000050E67F019BA84938CD03\
F2D70000000049454E44AE42608200", "hex");
    const fs = require('fs');
    fs.writeFileSync('installer_background.png', b1);

    core.debug(new Date().toTimeString())
    await exec(`create-dmg --volname "${name}" --background "installer_background.png" --window-pos 200 120 --window-size 800 450 --icon-size 100 --icon ${name}.app 200 185 --app-drop-link 600 185 ${name}.dmg ${srcdir}`);
    core.debug(new Date().toTimeString())

    core.setOutput('time', new Date().toTimeString())
  } catch (error) {
    if (error instanceof Error) core.setFailed(error.message)
  }
}

run()
